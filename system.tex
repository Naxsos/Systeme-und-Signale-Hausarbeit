\section{Vorgehen in Regelungstechnik}
Zur Ermöglichung einer strukturierten Vorgehensweise bedarf es einer Orientierung. Dieser Arbeit liegt die in der Vorlesung behandelte Vorgehensweise in der Regelungstechnik zugrunde, welche nachfolgend erläutert wird.

\begin{enumerate}
    \item Detaillierungsgrad für das System festlegen
    \item Physikalisches Modell einschließlich der Störsignale erstellen
    \item Eingangs-, Ausgangs-, Zustands- und Störgrößen des Systems festlegen
    \item Physikalische Einheiten festlegen und ggf. Normierung in Prozent
    \item Analyse des Modells
    \begin{enumerate}
        \item Ruhelagen, Anfangswerte, evtl. Linearisierung nichtlinearer Systeme
        \item Systemeigenschaften ermitteln
    \end{enumerate}
    \item Entwurf
    \begin{enumerate}
        \item Ziele, Arbeitspunkte und Trajektorien festlegen
        \item Entwurf: Struktur, Bereich, Verfahren und Kriterien
    \end{enumerate}
    \item Simulation und Rückinterpretation
\end{enumerate}

\section{Das System}
Wir betrachten einen Wassertank, der oben an einen Zufluss mit sehr hohem Druck angeschlossen ist. Unten befindet sich ein deutlich kleiner Abfluss, an den eine lange Wasserleitung angeschlossen ist. Erst am Ende der Wasserleitung befindet sich ein Messgerät, welcher den Volumenstrom misst.
Eine beispielhafte Skizze sieht folgendermaßen aus:
\begin{figure}[H]
    \label{fig:tank}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/Tank.png}
    \caption{Skizze des Systems}
 \end{figure}
Der Ablauf ist wie folgt: Über den Zufluss fließt Wasser in den Tank, da der Ausfluss aber deutlich kleiner ist, fließt erstmal deutlich weniger Wasser heraus. Erst wenn der Tank voller wird, erhöht sich der Druck und es kommt zu einem immer größeren Volumenstrom bis schließlich der Tank voll ist und der Druck des Zuflusses dafür sorgt, dass der Volumenstrom am Ausfluss gleich dem am Abfluss ist. Da das Messgerät aber weit entfernt vom Tank liegt, misst dieses den ganzen Vorgang erst mit einer gewissen Verzögerung.

Je nachdem wie groß der Tank ist, verändert sich die Konstante $T_1$: Je kleiner der Tank, desto größer ist $T_1$. Gleichzeitig bestimmt der Abstand zwischen dem Tank und dem Messgerät die Zeitkonstante $T_t$: Je größer der Abstand, destor größer ist $T_t$.

\subsection{Größen}
Die Eingangsgröße $u(t)$ ist in unserem Beispiel der Volumenstrom am Zufluss, angegeben z.\,B. in $\frac{l}{min}$. Der Zustand $x(t)$ ist der Volumenstrom am Ausfluss und der Ausgang $y(t)$ ist der gemessene Volumenstrom am Messgerät.


\subsection{Bezeichnung}
Das System hat den Nennergrad 1, eine Totzeit $T_t$ und einem proportionalen Übertragungsverhalten. Daraus ergibt sich die Bezeichnung $PT_{1}T_{t}$.

\subsection{Übertragungsfunktion}

Formel \ref{eq:G(s)_1} zeigt die Übertragungsfunktion die in diesem Skript analysiert wird. Formel \ref{eq:G(s)_3} zeigt eine etwas andere Darstellung der Formel, sodass die Eigenschaften des Systems leichter abzulesen sind.

\begin{eqnarray}
    \label{eq:G(s)_1}
    G(s) &=& \frac{Y(s)}{U(s)} \\
    \label{eq:G(s)_2}
    &=& \frac{1 * e^{-2s}}{(1+s)} \\
    \label{eq:G(s)_3}
    &=& \frac{1}{1 + s} * e^{-2s}
\end{eqnarray}

\subsection{Eingabe in MATLAB}
Für die Eingabe der Übertragungsfunktion in MATLAB gibt es zwei Möglichkeiten. \\
In manueller Eingabe schreibt man \texttt{G(s) =  1 / (1 + s) * exp(-2 * s)}. \\
In Computer-Algebra wird der Befehl \texttt{sys = tf([1], [1, 1],\textquotedbl IODelay\textquotedbl, 2)} benötigt. Hierbei werden in den beiden Vektoren die Koeffizienten vor $s^0$ bzw. $s^1$ (im Nenner) angegeben. Bei komplizierteren Gleichungen hilft dabei der Befehl \texttt{expand(G(s))}, der einem die benötigten Koeffizienten liefert, was hier jedoch nicht nötig war. Darauf folgt der Befehl \texttt{\textquotedbl IODelay\textquotedbl}, mit dem die Totzeit $t = 2$ angegeben wird.\\
In beiden Fällen wird in MATLAB damit die Formel \ref{eq:G(s)_3} dargestellt.

\section{Darstellungsformen des Systems}

\subsection{Explizite Darstellung des Übertragungsoperators}

\subsection{Zustandsraumdarstellung}
Die allgemeine Form der Zustandsraumdarstellung lautet:
\begin{align*}
    \dot x & = Ax + Bu \nonumber \\
    y & = Cx + Du
\end{align*}

Mit dem MATLAB-Befehl \texttt{ss(sys)} (ss steht für State Space) berechnet MATLAB automatisch die Werte für unser System. Somit sieht die Zustandsraumdarstellung hier folgendermaßen aus:
\begin{subequations}
    \begin{align*}
        \dot x & = \begin{bmatrix}
            -1
        \end{bmatrix}x + \begin{bmatrix}
            1
        \end{bmatrix}u \\
        y & = \begin{bmatrix}
            1
        \end{bmatrix}x + \begin{bmatrix}
            0
        \end{bmatrix}u
    \end{align*}
\end{subequations}


Man kann auch die Zustandsraumdarstellung direkt eingeben, indem man man die Matrizen $A, B, C, D$ belegt und den Befehl \texttt{sys = ss(A, B, C, D)} ausführt. Von hier aus kommt man mit \texttt{tf(sys)} wieder zur Übertragungsfunktion.

Ohne Matlab kann die Zustandsraumdarstellung in einfachen Fällen mithilfe des Substitutionstricks aus der Übertragungsfunktion erstellt werden. Für Systeme, bei denen auch $\dot u, \ddot u, \ldots$ in der Differentialgleichung vorkommt, ist das Ganze ein bisschen komplizierter, wird aber in \href{https://de.wikipedia.org/wiki/Zustandsraumdarstellung#Regelungsnormalform}{Wikipedia} beschrieben und kann entsprechend angewendet werden. Bei sprungfähigen Systemen sieht das noch etwas anders aus und es muss erst eine Polynomdivision gemacht werden, um $D$ zu erhalten. Im Mehrgrößenfall ist es noch komplizierter.

Sind die Matrizen $A, B, C, D$ bekannt, kommt man mit der folgenden Formel zur Übertragungsfunktion $G(s)$, wobei $I$ die Einheitsmatrix darstellt.
\[
    G(s) = C(s * I - A)^{-1} * B + D
\]
In unserem System erhält man damit aber nicht die eigentliche Übertragungsfunktion, da die Totzeit $T_t$ verloren geht. Im Zustandsraum stellt sich die Totzeit folgendermaßen dar:
\[
    \dot x = Ax + Bu(t - T_t)
\]
--> HIER NOCHMAL GROELL NACHFRAGEN

\subsubsection*{Explizite Darstellung}

Sind zusätzlich die Anfangswerte bekannt, so lässt sich $x(t)$ und $y(t)$ wie folgt berechnen:

\begin{align*}
    x(t) & = e^{A(t-t_0)} * x(0) * \int_{0}^{t} e^{A(t-t_0)}Bu(\tau) \,d\tau \nonumber \\
    y(t) & = Ce^{A(t-t_0)} * x(0) + C \int_{0}^{t} e^{A(t-t_0)}Bu(\tau) \,d\tau + Du(t)
\end{align*}

Hier ist bei der Eingabe in MATLAB wichtig zu beachten, dass für $e^{(\ldots)}$ nicht \texttt{exp}, sondern \texttt{expm}, verwendet wird, da man hier die Matrizenmultiplikation benötigt.

\subsubsection*{Anfangswerte}

Für die Simulation werden die Anfangswerte, da der Start der Funktion definiert sein muss. Hierbei müssen die linken Grenzwerte verwendet werden, da sonst eventuelle Sprünge miteinbezogen würden. Es gilt:
\begin{subequations}
    \begin{align*}
        y(0^-) & = Cx(0^-) + D(0^-) \\
        \dot y(0^-) & = CAx(0^-) + CBu(0^-) + D \dot u (0^-)
    \end{align*}
\end{subequations}

Darüber hinaus gibt es einen Zusammenhang mit der Eingangs- / Ausgangs-Differentialgleichung: Die Anfangswerte des Zustandsraumes $x$ müssen mit denen der Eingangs- / Ausgangs-Differentialgleichung $y$ korrespondieren und sind mit folgender Formel umzurechnen:

\begin{subequations}
    \begin{align*}
        \left(\begin{array}{c} y \\ \dot y \\ \ddot y \end{array}\right) &= \left(\begin{array}{l} C^T \\ C^T A \\ C^T A^2 \end{array}\right) \left(\begin{array}{c} x_1 \\ x_2 \\ x_3 \end{array}\right) \\
        \left(\begin{array}{c} x_1 \\ x_2 \\ x_3 \end{array}\right) &= \left(\begin{array}{l} C^T \\ C^T A \\ C^T A^2 \end{array}\right)^{-1} \left(\begin{array}{c} y \\ \dot y \\ \ddot y \end{array}\right)
    \end{align*}
\end{subequations}

Wir gehen bei unserem System davon aus, dass der Tank zu Beginn leer ist, somit kein Ausfluss vorliegt, und auch kein Zufluss herrscht. Somit sind alle Anfangswerte gleich $0$.

\subsubsection{Integralgleichung}
\subsubsection{Differentialgleichung}

\begin{subequations}
    \begin{align*}
        y(t) & = x(t - 2)
    \end{align*}
\end{subequations}


\subsection{Eingangs- /Ausgangs Differentialgleichung}

Dieses und das folgende Kapitel sind bei meinen Mitschrieben als 3a und 3b zusammengefasst

\begin{eqnarray*}
    G(s) &=& \frac{1}{1 + s} * e^{-2s}\\
    G_{PT_1}(s) =\frac{Y(s)}{U(s)} &=& \frac{1}{1 + s} \\
    Y(s)(1+s) &=& (1) * U(s) \\
    Y(s) + Y(s) *s &=& 1*U(s) \\
    \dot y(t) + y(t) &=& 1 * u(t) 
\end{eqnarray*}

In dieser Differentialgleichung taucht die Totzeit $T_t$ nicht auf, da das Totzeitglied nicht mit einer gewöhnlichen Differentialgleichung beschrieben werden kann. Für die Funktionalbeziehung eines Totzeitglieds im Zeitbereich gilt: $y(t) = u(t-T_t)$. Für unser Beispiel mit der Totzeit $T_t = 2$ folgt somit:
\begin{eqnarray*}
    \dot y(t) + y(t) &=& u(t - 2) 
\end{eqnarray*}

--> GROELL NACHFRAGEN

Somit ist es für einige Betrachtungen einfacher, die Totzeit zu vernachlässigen.

\subsection{Übertragungsfunktion}
Entweder wir streichen das erste kapitel und schreiben hier den Kram hin, oder iwie doppelt, oder ne andere Lösung -> Theresa ist gefragt!

\subsection{Gewichtsfunktion (Impulsantwort)}
Dieses und das folgende Kapitel sind bei meinen Mitschrieben als 4a und 4b zusammengefasst


In Abbildung \ref{fig:impuls} ist die Reaktion des Systems auf technischen Eingangssprung zu sehen.
\\
In MATLAB lässt sich das mit dem Befehl \texttt{impulse(sys)} simulieren, wodurch man die numerische Lösung erhält. In MATLAB lässt sich das mit dem Befehl \texttt{step(sys)} simulieren, wodurch man die numerische Lösung erhält. Die Übergangsfunktionfunktion $h(t)$ lässt sich aber auch analytisch berechnen und man erhält die explizite Lösung. Hierbei hilft einem der Befehl \texttt{ilaplace()}, der die Laplace-Transformierte zurückliefert:
\begin{lstlisting}
    syms g(t)
    g(t) = ilaplace(H(s))
    t = [0:0.1:8]
    plot(t, g(t))
\end{lstlisting}

Beide Befehle führen zum folgenden Graphen:



\begin{figure}[H]
    \label{fig:impuls}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/ImpulsAntwortPT1Tt.eps}
    \caption{Impulsantwort}
 \end{figure}

\subsection{Übergangsfunktion (Sprungantwort)}

In Abbildung \ref{fig:sprung} ist die Reaktion des Systems auf den Heaviside-Funktion zu sehen. Diese ist wie folgt definiert:

\[
\sigma (t) = \begin{cases} 0 & \text{für t < 0} \\ 1 & \text{für t > 0} \end{cases}  
\]
\\
In MATLAB lässt sich das mit dem Befehl \texttt{step(sys)} simulieren, wodurch man die numerische Lösung erhält. Die Übergangsfunktionfunktion $h(t)$ lässt sich aber auch analytisch berechnen und man erhält die explizite Lösung. Hierbei hilft einem der Befehl \texttt{ilaplace()}, der die Laplace-Transformierte zurückliefert:

\begin{lstlisting}
    H(s) = G(s) / s
    syms h(t)
    h(t) = ilaplace(H(s))
    t = [0:0.1:8]
    plot(t, h(t))
\end{lstlisting} 

Beide Befehle führen zum folgenden Graphen:

\begin{figure}[H]
    \label{fig:sprung}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/SprungantwortPT1Tt.eps}
    \caption{Sprungantwort}
 \end{figure}


\subsection{Frequenzgang}
Dieses und die folgenden Kapitel sind in meinen Mitschrieben als 5a, 5b und 5c zusammengefasst.

Zum Frequenzgang $G(j * \omega)$ gelangt man, indem man in $G(s)$ das $s$ durch $j * \omega$ ersetzt.

Das bedeutet, das für jede Frequzenz $\omega$ eine komplexe Zahl $j$ mit Real- und Imaginärteil oder mit Betrag und Phase darstellt.

\subsection{Ortskurve (Nyquist-Plot)}
Im Nyquist-Plot wird der über $\omega$ parametrisierte Frequenzgang als Kurver in der komplexen Ebene mit Real- und Imaginärteil dargestellt.
MATLAB bietet hier den Befehl \texttt{nyquist(sys)} an, welche zum folgenden \hyperref[fig:nyquist]{Plot} führt. Dabei zeigt MATLAB die Kurve von $-\infty$ bis $+\infty$ an, was in unserem Beispiel jedoch nicht nötig ist.

\begin{figure}[H]
    \label{fig:nyquist}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/NyquistPT1Tt.eps}
    \caption{Nyquist-Plot}
 \end{figure}

 Darüber hinaus ist es in MATLAB möglich, mit dem Cursor entlang der Kurve zu gehen, um sich einzelne Werte genauer anzuschauen, wie in \autoref{fig:nyquistCursor} dargestellt.

 \begin{figure}[H]
    \label{fig:nyquistCursor}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/NyquistCursorPT1Tt.png}
    \caption{Screenshot: Informationen im Nyquist-Plot}
 \end{figure}

 Systemtheoretisch entspricht der Frequenzgang einem Schnitt der komplexen Funktion $G(s)$ entlang der imaginären Achse: $G(s)\Bigr\rvert_{s = j * \omega}$

\subsection{Bode-Diagramm}
Im Bode-Diagramm sind der Betrag des Frequenzgangs über $\omega$ in Dezibel(dB) und die Phase des Frequenzgangs über $\omega$ in Grad($^\circ$) dargestellt. Damit die Kurven schön aussehen, verwendet MATLAB eine doppelt logarithmische Darstellung. Der dazugehörige MATLAB-Befehl ist \texttt{bode(sys)}. Streng genommen wird in MATLAB im oberen Bild die Amplitudenverstärkung angzeigt, die ein Sinus-Signal stationär erfährt (bei Eigenwert = 1), währenddessen im unteren Bild die Phasenverstärkung zu sehen ist.

\begin{figure}[H]
    \label{fig:bode}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/BodePT1Tt.eps}
    \caption{Bode-Plot}
 \end{figure}

\subsection{Statische Kennlinie}
Da es sich bei unserem System um ein System mit proportionalen Übertragungsverhalten handelt, entspricht die statische Verstärkung $K = G(0)$ bzw. $K = \lim_{t\to \infty} h(t)$. Somit ergibt sich bei unserem System eine Verstärkung von 3, weshalb die statische Kennlinie nur eine konstante Funktion ist. Mithilfe des MATLAB-Befehls \texttt{fplot(3)} lässt sich das graphisch darstellen. 


\begin{figure}[H]
    \label{fig:staticCurve}
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/StaticCurvePT1Tt.eps}
    \caption{Statische Kennlinie}
 \end{figure}

\subsection{Pol-Nulstellen-Plot}
\autoref{fig:poleZero} zeigt den Pol-Nulstellen-Plot zu unserem System. Der passende MATLAB-Befehl hierfür lautet \texttt{pzplot(sys)}. MATLAB markiert mit \textbf{o} die Nullstellen und mit \textbf{x} die Polstellen des Systems. In unserem Beispiel hat das System aber keine Nulstellen, da der Zählergrad 0 ist, weshalb in der Abbildung kein \textbf{o} zu sehen ist. Da der Nenner unseres Systems aber den Grad 1 mit $1 + s$ ist, hat unserer System eine reale Polstelle bei s = -1, was in der Abbildung mit den \textbf{x} gekennzeichnet ist.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Bilder/PoleZeroPT1Tt.eps}
    \caption{Bode-Plot}
 \end{figure}
 \label{fig:poleZero}
 %Warum auch immer muss hier das Label nach die Figure und nicht da rein, sonst haben wir ein Problem

